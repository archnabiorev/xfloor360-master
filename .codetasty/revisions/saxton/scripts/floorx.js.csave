codetasty.revision.2.0
{"ts":1520448824,"restoring":false,"user_id":4416,"patch":[{"diffs":[[1,"window.MortageCalcInit = false;\nvar floorx = function(){\n_self = this;\n FLOORXDATA[0].image = GLOBAL_IMAGE;\n_self.fxData = FLOORXDATA;\n//window.stages = [];\n_self.stages  = [];\t\t\nwindow.GLOBAL_LAST_NTH = 0;\nwindow.forcedEvent = false;\n\n_self.loadAllElevations = function(){\n\n\t$.get('floorx-data/templates/elevation-left.mst' , function(template){\n\t\tconsole.log(_self.fxData);\n\t\tvar render = Mustache.render(template , { elevations :  _self.fxData });\n\n\t\t$('#elevation-wrapper').html(render);\n\n\t\t$('.single-elevation').eq(0).trigger('click');\n\n\t\t//process \n\n\t\tsetTimeout(function(){\n\t\t\t$('#fs-loading').fadeOut();\n\t\t}, 2000);\n\n\n\t});\n\n}\n\n_self.loadFloorByIds = function(floorIDs , preventInteractive){\n\n\t// var sample = [{\n\t// \tname : \"Floor1\",\n\t// \tvariations : [{\n\t// \t\tname : \"name\",\n\t// \t\timg : \"img\",\n\t// \t\tcoord : [1,1]\n\t// \t}]\n\t// }];\n\tvar floors_struct = [];\n\tfor( var _i = 0 ; _i < floorIDs.length ; _i++ ){\n\t\tvar floorID = floorIDs[_i];\n\tvar floors = DB[\"lots\"][floorID][\"modules\"];\n\tfor( var i = 0 ; i < floors.length ; i ++ ){\n\t\tvar varz = DB[\"layer_packs\"][floorID];\n\t\tvarz = varz[ Object.keys(varz)[0] ];\n\t\tfor(var k = 0 ; k < varz.length ; k++){\n\n\t\t\tvarz[k].coords = (typeof varz[k].coords == \"string\" ) ? varz[k].coords :  JSON.stringify(varz[k].coords);\n\t\t}\n\t\tvar t = {\n\t\t\tfloor_name : (floors[i].alias) ? floors[i].alias : floors[i].label,\n\t\t\timg : floors[i].layerImgUrl,\n\t\t\tFLOORID : floorID,\n\t\t\tid : floors[i].id,\n\t\t\tvariations : varz\n\t\t}\n\t\tfloors_struct.push(t);\n\t}\n}\n\t\n\n\t$.get('floorx-data/templates/floors-left.mst' , function(template){\n\t\tvar render = Mustache.render( template , { floors : floors_struct } );\n\t\t$('#floorvars-wrapper').html(render);\n\t\tif( !preventInteractive ){\n\t\t\t_self.loadInteractive(floorIDs);\t\n\t\t}\n\n\t\t\n\t\t//inject sections \n\t\t$('ul.e-variations li').eq(1).before('<label class=\"label-head\">Den</label>');\n\t\t\t\n\t\t$('.option-tab').eq(0).attr('data-category' , 'Den');\n\t\t$('.option-tab').eq(1).attr('data-category' , 'Den');\n\t\t$('.option-tab').eq(2).attr('data-category' , 'Den');\n\t\t$('.option-tab').eq(3).attr('data-category' , 'Den');\n\n\t\t//Dinette\n\t\t$('ul.e-variations li').eq(5).before('<label class=\"label-head\"  for=\"cbox-Dinette__Optional_Dinette-parent\"> <input id=\"cbox-Dinette__Optional_Dinette-parent\" data-for=\"cbox-Dinette__Optional_Dinette\" data-prevents=\"cbox-Dinette__Optional_Dinette_Ceiling\" type=\"checkbox\" style=\"display:none;\" class=\"checkbox-gk parent-switch\" /> <span class=\"check-slider round\"></span> Optional Dinette </label>');\n\t\t// $('ul.e-variations li').eq(5).before('<label class=\"label-head\">Dinette</label>');\n\t\t\n\t\t//add a restricting layer\n\t\t$('.option-tab').eq(4).attr('data-category' , 'Dinette');\n\t\t$('.option-tab').eq(4).hide()\n\t\t$('.option-tab').eq(5).prepend('<div id=\"preventor-'+$('.option-tab').eq(5).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t$('.option-tab').eq(5).attr('data-category' , 'Dinette');\n\n\t\t//Dining Room\n\t\t$('ul.e-variations li').eq(7).before('<label class=\"label-head\">Dining Room</label>');\n\n\t\t$('.option-tab').eq(6).attr('data-category' , 'Dining Room');\n\t\t$('.option-tab').eq(7).attr('data-category' , 'Dining Room');\n\t\t$('.option-tab').eq(8).attr('data-category' , 'Dining Room');\n\t\t$('.option-tab').eq(9).attr('data-category' , 'Dining Room');\n\t\t$('.option-tab').eq(10).attr('data-category' , 'Dining Room');\n\n\n\t\t//Family Entry\n\t\t$('ul.e-variations li').eq(12).before('<label class=\"label-head\">Family Entry</label>');\n\n\t\t$('.option-tab').eq(11).attr('data-category' , 'Family Entry');\n\t\t$('.option-tab').eq(12).attr('data-category' , 'Family Entry');\n\t\t\n\t\t//Garage\n\t\t$('ul.e-variations li').eq(14).before('<label class=\"label-head\">Garage</label>');\n\n\t\t$('.option-tab').eq(13).attr('data-category' , 'Garage');\n\t\t$('.option-tab').eq(14).attr('data-category' , 'Garage');\n\t\t$('.option-tab').eq(15).attr('data-category' , 'Garage');\n\t\t$('.option-tab').eq(14).prepend('<div id=\"preventor-'+$('.option-tab').eq(14).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t$('.option-tab').eq(15).find('input').attr('data-affects' , 'cbox-Garage__Optional_Garage_Door');\n\t\t$('.option-tab').eq(15).find('input').addClass('list-affector-element');\n\n\n\t\t\n\t\t//Great Room\n\t\t$('ul.e-variations li').eq(17).before('<label class=\"label-head\">Great Room</label>');\n\n\t\t$('.option-tab').eq(16).attr('data-category' , 'Great Room');\n\t\t$('.option-tab').eq(17).attr('data-category' , 'Great Room');\n\t\t$('.option-tab').eq(18).attr('data-category' , 'Great Room');\n\n\t\t//Optional Kitchen and Laundry\n\t\t$('ul.e-variations li').eq(20).before('<label class=\"label-head\">Optional Kitchen and Laundry</label>');\n\n\t\t$('.option-tab').eq(19).attr('data-category' , 'Optional Kitchen and Laundry');\n\n\n\t\t//Sun Room\n\t\t//$('ul.e-variations li').eq(21).before('<label class=\"label-head\">Sun Room</label>');\n        $('ul.e-variations li').eq(21).before('<label class=\"label-head\"  for=\"cbox-Sun_Room__Sun_Room_Optiona01-parent\"> <input id=\"cbox-Sun_Room__Sun_Room_Optiona01-parent\" data-for=\"cbox-Sun_Room__Sun_Room_Optiona01\" data-prevents=\"cbox-Sun_Room__Door_and_Window,cbox-Sun_Room__Optional_Half_Round_Wind,cbox-Sun_Room__Optional_Sunlight,cbox-Sun_Room__Optional_Sunlight02,cbox-Sun_Room__Patio\" type=\"checkbox\" style=\"display:none;\" class=\"checkbox-gk parent-switch\" /> <span class=\"check-slider round\"></span> Optional Dining Room </label>');\n\n\t\t$('.option-tab').eq(20).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(20).prepend('<div id=\"preventor-'+$('.option-tab').eq(20).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t\n\t\t$('.option-tab').eq(21).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(21).prepend('<div id=\"preventor-'+$('.option-tab').eq(21).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t\n\t\t$('.option-tab').eq(22).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(22).prepend('<div id=\"preventor-'+$('.option-tab').eq(22).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t\n\t\t$('.option-tab').eq(23).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(23).prepend('<div id=\"preventor-'+$('.option-tab').eq(23).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\t\t\n\t\t$('.option-tab').eq(24).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(24).prepend('<div id=\"preventor-'+$('.option-tab').eq(24).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\n\t\t$('.option-tab').eq(25).attr('data-category' , 'Sun Room');\n\t\t$('.option-tab').eq(25).hide()\n\t\t$('.option-tab').eq(25).prepend('<div id=\"preventor-'+$('.option-tab').eq(25).find('input').attr('id')+'\" class=\"list-preventor\"> </div>')\n\n\n\n\n\t\t// $('ul.e-variations li').eq(3).before('<label class=\"label-head\"> Bedrooms 3</label>');\n\t\t\n\t\t// $('.option-tab').eq(2).attr('data-category' , 'Bedrooms 3');\n\t\t// $('.option-tab').eq(3).attr('data-category' , 'Bedrooms 3');\n\t\t\n\t\t// $('.option-tab').eq(4).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(5).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(6).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(7).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(8).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(9).attr('data-category' , 'Optional Dining Room');\n\t\t// $('.option-tab').eq(10).attr('data-category' , 'Optional Dining Room');\n\t\t\n\t\t// $('.option-tab').eq(11).attr('data-category' , 'Garage Door');\n\t\t// $('.option-tab').eq(12).attr('data-category' , 'Garage Door');\n\t\t// $('.option-tab').eq(13).attr('data-category' , 'Garage Door');\n\t\t\n\t\t// $('.option-tab').eq(14).attr('data-category' , 'Kitchen');\n\t\t// $('.option-tab').eq(15).attr('data-category' , 'Kitchen');\n\t\t// $('.option-tab').eq(16).attr('data-category' , 'Kitchen');\n\t\t// $('.option-tab').eq(17).attr('data-category' , 'Kitchen');\n\t\t// $('.option-tab').eq(18).attr('data-category' , 'Kitchen');\n\t\t\n\t\t// $('.option-tab').eq(19).attr('data-category' , 'Main Bath');\n\t\t\n\t\t// $('.option-tab').eq(20).attr('data-category' , 'Owner\\'s Suite Option');\n\t\t// $('.option-tab').eq(21).attr('data-category' , 'Owner\\'s Suite Option');\n\t\t// $('.option-tab').eq(22).attr('data-category' , 'Owner\\'s Suite Option');\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t// $('ul.e-variations li').eq(5).before('<label class=\"label-head\" for=\"active-dining\"> <input id=\"active-dining\" type=\"checkbox\" style=\"display:none;\" class=\"checkbox-gk\" /> <span class=\"check-slider round\"></span> Optional Dining Room </label>');\n\t\t\n\t\t// $('ul.e-variations li:eq(5)  , ul.e-variations li:eq(6) ').wrapAll('<div class=\"preventor-parent\"></div>');\n\n\t\t// $('ul.e-variations li:eq(6)').find('label').css({\n\t\t// \t\"border-bottom\" : \"1px solid #000\"\n\t\t// });\n\n\t\t// $('.preventor-parent').prepend('<div class=\"preventor\"></div>');\n\t\t\n\n\t\t// $('ul.e-variations li').eq(12).before('<label class=\"label-head\"> Garage Door </label>');\n\t\t// $('ul.e-variations li').eq(15).before('<label class=\"label-head\"> Kitchen </label>');\n\n\t\t// $('ul.e-variations li').eq(17).prepend('<div class=\"preventor-cathe\"></div>');;\n\n\t\t// $('ul.e-variations li').eq(20).before('<label class=\"label-head\"> Main Bath </label>');\n\t\t// $('ul.e-variations li').eq(21).before('<label class=\"label-head\"> Owner\\'s Suite option </label>');\n\n\t\t// $('ul.e-variations li').eq(10).hide();\n\n\t\n\n\t\t\n\t});\n\n\n}\n\n_self.loadInteractive = function(floorIDs){\n\twindow.stages = {};\n\twindow.floorModules = {};\n\twindow.floorModulesRects = {};\n\n\t\n\t//TODO : destroy if present\n\t$.get('floorx-data/templates/right-floors.mst' , function(template){\n\t\t\n\t\t//right elevation\n\t\tvar render = Mustache.render(template , { floorList : floorIDs });\n\t\t$('#interactive-pre-wrapper').html(render);\n\t\tfor( var i = 0 ; i < floorIDs.length ; i++ ){\n\t\t\tvar stageid = 'stage-'+floorIDs[i];\n\t\t\tvar base = DB[\"lots\"][floorIDs[i]].base;\n\t\t\tstage = new createjs.Stage(stageid);//Add new stage\n\t\t\tstages[stageid] = stage;\n\t\t\t_self.floorCanvasRenderer(stageid , stage , base);\n\n\t\t\t$(\"#\"+stageid).panzoom();\n\n\t\t\t// Pass options\n\t\t\t$(\"#\"+stageid).panzoom({\n\t\t\t  minScale: 1,\n\t\t\t  maxScale : 2,\n\t\t\t  $zoomRange: $(\"input[type='range']\")\n\t\t\t});\n\n\t\t\t$(\"#\"+stageid).panzoom(\"zoom\" , 1.1);\n\n\t\t\t\n\n\n\t\t\t}\n\n\t\t\t$(window).trigger('resize');\n\t\t\t\n\t\t\t//bind event \n\t\t\t$('.collapse-parent').on('hide.bs.collapse', function () {\n\t\t\t  var target = $(this).data('target');\n\t\t\t  $(target).removeClass('active').addClass('collapsed');\n\t\t\t});\n\n\t\t\t$('.collapse-parent').on('show.bs.collapse', function () {\n\t\t\t  var target = $(this).data('target');\n\t\t\t  $(target).removeClass('collapsed').addClass('active');\n\t\t\t});\n\n\t\t\t$('.floor-selectron').eq(0).trigger('click');\n\n\n\n\n\n\t});\n\n\n};\n\n\n_self.floorCanvasRenderer = function(stageID , stage,base){\n\tsafeLoad(base , \"test\").then(function(response){\n\tvar img =  response.queue.getResult(response.id);\n\tdocument.getElementById(stageID).width = img.width;\n\tdocument.getElementById(stageID).height = img.height;\n\n\t_self.base = new createjs.Bitmap( img );//Add new base\n\n\t//add base to scene\n\tstage.addChild(_self.base);\n\t_self.base.x = 0;\n\t_self.base.y = 0;\n\tstage.update();\n\t});\n\n\n\n\n\n\n\n\n}\n\n_self.rectDrawer = function( config )\t{\n\n\t\t\t\tvar stage = stages[config.stageid];\n\t\t\t//required keys of config, if any of this is missing, it should return error\n\t\t\tvar required = [\"id\",\"label\",\"drawX\",\"drawY\",\"dataSF\",\"w\",\"h\",\"strokeColor\",\"fillColor\",\"strokeStyle\"];\n\n\n\t\t\tfor ( i in required){\n\t\t\t\tvar _key = required[i];\n\t\t\t\tif( typeof config[_key] == \"undefined\" ){\n\t\t\t\t\talert( \"Error in drawing, value of \\\" \"+_key+\" \\\" is missing, please check log for more details\" );\n\t\t\t\t\tconsole.log(\"Tried to render rect with following config : \");\n\t\t\t\t\tconsole.log(config);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\t\t\t//always make sure that the argument length is on less than total\n\t\t\t//the last argument tells if update has to be made or not\n\n\t\t\tif( typeof config.image == \"undefined\" ){\n\t\t\tvar finalRect = new createjs.Shape();\n\t\t\tvar strokeColor = finalRect.graphics.beginStroke( config.strokeColor ).command;\n\t\t\tvar fillColor = finalRect.graphics.beginFill( config.fillColor).command;\n\t\t\tfinalRect.graphics.setStrokeStyle(config.strokeStyle);\n\t\t\tfinalRect.snapToPixel = true;\n\t\t\tfinalRect.graphics.drawRect(0, 0, config.w, config.h);\n\n\t\t\t}else{\n\t\t\t\tconfig.image.crossOrigin = \"Anonymous\";\n\t\t\t \t\n\t\t\t \t var box = new createjs.Shape();\n\t\t\t\t box.graphics.beginLinearGradientFill([\"#ff0000\", \"rgba(255, 0, 0, 1)\"], [1, 0.9], 0, 0, config.w, config.h)\n\t\t\t\t box.graphics.drawRect(0, 0, config.w, config.h);\n\t\t\t\t box.cache(0, 0, config.w, config.h);\n\n\t\t\t\tvar finalRect = new createjs.Bitmap(config.image);\n\t\t\t\tfinalRect.filters = [\n\t\t\t\t     new createjs.AlphaMaskFilter(box.cacheCanvas)\n\t\t\t\t ];\n\t\t\t\t finalRect.cache(0, 0, config.w , config.h);\n\n\n\n\n\t\t\t}\n\t\t\t\n\n\t\t\t \n\n\n\n\t\t\t //finalRect.graphics.beginBitmapFill(img, \"no-repeat\");\n\t\t\t\n\n\t\t\tfinalRect.regX = config.image.width/2;\n\t\t\tfinalRect.regY = config.image.height/2;\n\t\t\t\n\t\t\t//Append data\n\t\t\tfinalRect.data = {\n\t\t\t\tdataX : config.drawX,\n\t\t\t\tdataY : config.drawY,\n\t\t\t\tdataW : config.w,\n\t\t\t\tdataH : config.h,\n\t\t\t\tlayerPackID : config.layerPackID,\n\t\t\t\tcurrent : config.currentLayer,\n\t\t\t\tdataSF : config.dataSF,\n\t\t\t\thasDragged : false,\n\t\t\t\tlabel : config.label,\n\t\t\t};\n\t\t\tfinalRect.id = config.id;\n\n\t\t\tfinalRect.x = config.drawX + ( config.image.width/2 );\n\t\t\tfinalRect.y = config.drawY + ( config.image.height/2 );\n\t\t\t// finalRect.x = config.drawX;\n\t\t\t// finalRect.y = config.drawY;\n\t\t\tfinalRect.dataSF = config.dataSF;\n\n\n\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\n\n\t\t\tfinalRect.commands = { strokeColor : strokeColor  , fillColor : fillColor   };\n\t\t\t//finalRect.commands = { bitmap : finalRect   };\n\t\t\t\n\n\t\t\t//bind event listeners\n\t\t\t// finalRect.addEventListener('click' , onModuleClick);\n\t\t\t// finalRect.addEventListener('pressmove' , onModuleDragging);\n\t\t\t// finalRect.addEventListener('pressup' , onModuleDragStop);\n\n\t\t\t//add rectangle \n\t\t\tvar rect = new createjs.Shape();\n\t\t\tvar strokeColor = rect.graphics.beginStroke( 'rgba(0,0,0,0.0)' ).command;\n\t\t\tvar fillColor = rect.graphics.beginFill( 'rgba(96, 181, 0, 0.5)' ).command;\n\t\t\trect.graphics.setStrokeStyle( 2 );\n\t\t\trect.snapToPixel = true;\n\t\t\trect.graphics.drawRect(0, 0, config.w, config.h);\n\n\t\t\trect.regX = config.image.width/2;\n\t\t\trect.regY = config.image.height/2;\n\n\t\t\trect.x = config.drawX + ( config.image.width/2 );\n\t\t\trect.y = config.drawY + ( config.image.height/2 );\n\n\n\t\t\tfloorModulesRects[config.moduleID] = rect;\n\t\t\tstage.addChild(finalRect);\n\t\t\tstage.addChild(rect);\n\t\t\tstage.update();\n\n\n\t\t\treturn finalRect;\n}\n\n_self.loadNthElevation = function(nth){\n\n\t$.get('floorx-data/templates/elevation-right.mst' , function(template){\n\t\t\n\t\t//right elevation\n\t\t//_self.fxData[nth].image = GLOBAL_IMAGE;\n\t\tvar render = Mustache.render(template , _self.fxData[nth]);\n\n\t\t$('#right-wrapper').html(render);\n\n\t});\n\n\t$.get('floorx-data/templates/top-details.mst' , function(template){\n\t\t\n\t\t//left elevation\n\n\t\tvar render = Mustache.render(template , _self.fxData[nth]);\n\n\t\t$('#bs-example-navbar-collapse-1').html(render);\n\n\t});\n\n\t//texts \n\t$('#elevation-name').text(_self.fxData[nth].name);\n\n\t//inject floor \n\n\t//_self.loadFloorByIds(_self.fxData[nth].planID);\n\n};\n\n\n\n\n_self.loadAllElevations();\n\n\n/*----------  Events  ----------*/\n\n\n$(document).on('click' , '#floor-tab' , function(){\n\n\t$('#right-wrapper').fadeOut();\n\t$('.main-stage').block({ css: { \n            border: 'none', \n            padding: '15px', \n            backgroundColor: '#000', \n            '-webkit-border-radius': '10px', \n            '-moz-border-radius': '10px', \n            opacity: .5, \n            color: '#fff'\n        }, \n         overlayCSS:  { \n        backgroundColor: '#fff', \n        opacity:         0.6, \n        cursor:          'wait' \n    }, \n \n        message : 'Processing'\n         });\n\tsetTimeout(function(){\n\t\t$('.main-stage').unblock();\n\t\t$('#interactive-pre-wrapper').fadeIn();\n\t},1000);\n\t\n\n\t// $('#right-wrapper').block();\n\t// _self.loadFloorByIds(_self.fxData[GLOBAL_LAST_NTH].planID);\n\t// $(this).attr('aria-expanded',\"true\");\n\n\t//$('.custom-tabs').tab('show');\n\n\n});\n\n$(document).on('click' , '#elevation-tab' , function(){\n\n_self.loadNthElevation(GLOBAL_LAST_NTH);\n\n\t$('#right-wrapper').show();\n\t$('#interactive-pre-wrapper').hide();\n\n});\n\n\n$(document).on('click' , '#notes-tab' , function(){\n\n\tvar note = window.localStorage.getItem(\"floor-note\");\n\n\t$('#note-textarea').val(note);\n\n});\n\nvar uploadImage = function(base64 , imgRef)\n    {\n\n        return new Promise(function(resolve , reject){\n\n      var lotIdRef = storageRef.child( imgRef );\n            var uploadTask = lotIdRef.putString(base64, 'data_url' ); \n\n            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'\n\n        function(snapshot) {\n          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n          var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          console.log('Upload is ' + progress + '% done');\n          $('#progress-percentage').html( Math.round(progress) +'%');\n          switch (snapshot.state) {\n          case firebase.storage.TaskState.PAUSED: // or 'paused'\n          console.log('Upload is paused');\n          break;\n          case firebase.storage.TaskState.RUNNING: // or 'running'\n          console.log('Upload is running');\n          break;\n          }\n        },\n        function(error) {\n          reject(error);\n        }, function() {\n        // Upload completed successfully, now we can get the download URL\n        var downloadURL = uploadTask.snapshot.downloadURL;\n        resolve(uploadTask.snapshot);\n        }\n        );\n\n\n\n        });\n\n\n    };\n\n\n$(document).on('click' , '#finish-modulesz' , function(e){\n\te.preventDefault();\n\t//window.location.href= \"/#!/final\";\n\n\t\n\te.preventDefault();\n\t//swal(\"Finish\" ,\"Selection completed. We'll be in contact with you soon.\" , \"success\");\n\n\t//Create linkable \n\n\tvar linkData = {\n\t\timage : $('.front-image-wrapper').find('img').eq(0).attr('src'),\n\t\tmodules : GLOBAL_FINAL.modules,\n\t\thomeXData : GLOBAL_FINAL_HOMEX,\n\t\tfloorplans : { 'First Floor' : 'imageURL' }\n\t};\n\n\t/*==================================\n\t=            SAVE TO DB            =\n\t==================================*/\n\t\n\t\t\t\t\t$('body').block({ css: { \n            border: 'none', \n            padding: '15px', \n            backgroundColor: '#000', \n            '-webkit-border-radius': '10px', \n            '-moz-border-radius': '10px', \n            opacity: .5, \n            color: '#fff'\n        }, \n         overlayCSS:  { \n        backgroundColor: '#fff', \n        opacity:         0.6, \n        cursor:          'wait' \n    }, \n \n        message : 'Saving session <span id=\"progress-percentage\"></span>'\n         });\n\n           var sessionid = uuid();\n           var image = $('canvas')[0].toDataURL();\n           var imageId = uuid();\n          \n          uploadImage(image , imageId+'.png' ).then(function(favImage){\n\n          \tlinkData.floorplans['First Floor'] = favImage.downloadURL\n            firebase.database().ref('/forbesxFloor/'+sessionid).set(linkData).then(function(snap){\n            \n            \t//window.location.href = 'http://forbes.xfloor360.com/#!/?id='+sessionid;\n            \t$('body').unblock();\n            \t//store data in global var\n\t\t\t\tGLOBAL_FINAL.base.image = $('canvas')[0].toDataURL();\n\t\t\t\tGLOBAL_FINAL.modules = [\n\t\t\t\t];\n\n\t\t\t\twindow.location.href = \"/#!/final/\"+sessionid;\n\n          }).catch(function(err){\n            //reject(err);\n            alert(err);\n            console.log(err);\n            $('body').unblock();\n\n          });\n\n\n          }).catch(function(err){\n          \talert(err);\n            console.log(err);\n            $('body').unblock();\n\n          });\n\n          \n\n\t\n\t\n\t/*=====  End of SAVE TO DB  ======*/\n\t\n\n\n\n\t\n\t//$('#fs-loading').hide();\n\t$('#side-widget').hide();\n\n\n\t//swal(\"Finish\" ,\"Selection completed. We'll be in contact with you soon.\" , \"success\");\n});\n\n\n$(document).on('click' , '#clear-button' , function(){\n\n\tvar note = window.localStorage.setItem(\"floor-note\" , \"\");\n\n\t$('#note-textarea').val(\"\");\n\n\tswal('Cleared' , \"Note has been cleared\" , \"success\");\n\n});\n\n\n\n\n$(document).on('click' , '.single-elevation' , function(e){\n\n\t//clear  and set global\n\n\twindow.GLOBAL_FINAL = {\n      base : {\n        image : '',\n        title : '',\n        beds : 0,\n        baths : 0,\n        sqft : 0,\n        garage : 0,\n        price : 0 \n      },\n      floorImages : [],\n      \n       modules : {\n      \n      // moduleID : {\n      //   name : '',\n      //   price : '',\n      //   imgUrl : ''\n      // }\n      \n       }\n\n    };\n\ne.preventDefault();\n//get index \nvar index = $(this).index();\nGLOBAL_LAST_NTH = index;\n_self.loadNthElevation(index);\n\n//inject \n\tvar ele = $(this);\n\tGLOBAL_FINAL.base.image = ele.find('img').eq(0).attr('src');\n\tGLOBAL_FINAL.base.title = ele.data('name');\n\tGLOBAL_FINAL.base.beds = ele.data('bedrooms');\n\tGLOBAL_FINAL.base.baths = ele.data('bathrooms');\n\tGLOBAL_FINAL.base.sqft = ele.data('total');\n\t//GLOBAL_FINAL.base.garage = ele.data('name');\n\tGLOBAL_FINAL.base.price = ele.data('price');\n\n\tvar planIDs = $(this).data('floors');\n\n\tplanIDs = planIDs.split(',');\n\tfor( var i in planIDs ){\n\t\tGLOBAL_FINAL.modules[ DB[\"lots\"][planIDs[i]].modules[0].label ] = { extraInfo : { image : DB[\"lots\"][planIDs[i]].base } };\n\t\t//GLOBAL_FINAL.floorImages.push( DB[\"lots\"][planIDs[i]].base );\n\t}\n\n\n\n//./inject\n\n_self.loadFloorByIds(_self.fxData[GLOBAL_LAST_NTH].planID , false);\n\n//fixHeights();\nif( MortageCalcInit ){\n\nvar t = document.getElementById('pslider');\nt.noUiSlider.updateOptions({\n    range: {\n        'min': 0,\n        'max': parseInt( $(this).data('price').replace(',' , '') )\n    }\n});\n}\n\n\nwindow.MortageCalcInit = true;\n//apply data to footer\n$('#footer-beds').html( $(this).data('bedrooms') );\n$('#UpdatedPrice').html( $(this).data('price') );\n$('#footer-baths').html( $(this).data('bathrooms') );\n$('#footer-area').html( $(this).data('total') );\n$('#footer-home-name').html( $(this).data('name') );\n\n$('#popup-base').html( $(this).data('price') );\n$('#total-price-counter').html( $(this).data('price') );\n\n\n\n//fixHeights();\n\n});\n\n\n_self.loadNthElevation(0);\n$(window).trigger('resize');\n\n$(document).on('change' , '.floor-selector' , function(){\n\nvar show = 'stage-'+ $(this).data('floorid');\t\n//hide all the floors\n$('.floor-selector').each(function(){\n\tvar i = $(this).data('floorid');\t\n\t$('#stage-'+i+'-wrapper').hide();\n});\n\nvar floorToRetain = 'ul'+$(this).attr('id')\n\n$('.collapse-parent').each(function(){\n\tif( $(this).attr('id') != floorToRetain ){\n\t\t$(this).collapse('hide')\n\t}\n})\n\n$('#'+show+'-wrapper').show();\n\n$(window).trigger('resize');\n\n\n});\n\n_self._formatter = wNumb({\n                        decimals: 0,\n                        thousand: ','\n                    });\n    \n\n\n/*===================================\n\t=            Special Ops            =\n\t===================================*/\n\nvar specialOps = function(stage , module){\n\n\t\t//push it to bottom\n\t\t//count stage children\n\t\tvar index = stage.children.length-1;\n\t\tstage.setChildIndex( module , 1 );\n\t\n\t\tvar index = stage.children.length-1;\n\t\tstage.setChildIndex( module , 1 );\n\t\tstage.update();\n\t\treturn true;\n\t\n\n\n};\t\n\t/*=====  End of Special Ops  ======*/\n\n\nvar modulePairingSystem = function(ele){\n\n\tvar conflicts = ele.data('conflicts') ? ele.data('conflicts').split(',') : false;\n\n\tif( conflicts && ele.is(':checked') ){\n\t\t//hide the conflicts\n\t\tfor( var i in conflicts ){\n\t\t\tvar c = conflicts[i];\n\t\t\tif( typeof floorModules[c] != \"undefined\"){\n\t\t\t$('input[data-combo=\"'+c+'\"]').prop('checked', false).trigger('change');\n\t\t\t\t}\n\n\t\t}\n\t\t\n\t\t\n\t}\n\n\tvar switchable = ele.data('switchable') ? ele.data('switchable').split(',') : false;\n\n\tif( switchable && ele.is(':checked') ){\n\t\t\n\t\tfor( var i in switchable ){\n\n\t\t\tvar s = switchable[i];\n\t\t\tif( typeof floorModules[s] != \"undefined\"){\n\n\t\t\t$('input[data-combo=\"'+s+'\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\n\t\t}\n\t\t\n\t}else{\n\n\t\tif( switchable ){\n\t\t\t$('input[data-combo=\"'+switchable[0]+'\"]').prop('checked', true).trigger('change');\n\t\t}\n\n\t}\n\n\n\n\t/*=======================================\n\t=            TEMPORARY HACK             =\n\t=======================================*/\n//\tif( (ele.data('combo') == 'layer_6893f374_5e13_f481_19d6_999dc5909508.png' ) || (ele.data('combo') == 'layer_e85d0bf6_b67d_d7b5_f1f9_2786ee79cfa1.png' ) ){\n\n\tif( $('input[data-combo=\"layer_6893f374_5e13_f481_19d6_999dc5909508.png\"]').prop('checked') || $('input[data-combo=\"layer_e85d0bf6_b67d_d7b5_f1f9_2786ee79cfa1.png\"]').prop('checked') ){\n\t\t$('.options-item').eq(0).find('li').eq(7).hide();\n\t\t$('.options-item').eq(0).find('li').eq(8).show();\n\t\t//trun 1 off if on \n\t\tif( $('input[data-combo=\"layer_d0563547_2276_1dd8_678a_a1fba869b188.png\"]').prop('checked') ){\n\t\t\t$('input[data-combo=\"layer_d0563547_2276_1dd8_678a_a1fba869b188.png\"]').prop('checked', false).trigger('change');\t\n\t\t}\n\t\t\n\t\t// $('input[data-combo=\"layer_45321595_18e5_36a2_b5db_076c0cebe8ef.png\"]').prop('checked', false).trigger('change');\n\t}else{\n\t\t$('.options-item').eq(0).find('li').eq(7).show();\n\t\t$('.options-item').eq(0).find('li').eq(8).hide();\n\t\t//turn 2 off if on \n\t\t// $('input[data-combo=\"layer_d0563547_2276_1dd8_678a_a1fba869b188.png\"]').prop('checked', false).trigger('change');\n\t\tif( $('input[data-combo=\"layer_45321595_18e5_36a2_b5db_076c0cebe8ef.png\"]').prop('checked') ){\n\t\t\t$('input[data-combo=\"layer_45321595_18e5_36a2_b5db_076c0cebe8ef.png\"]').prop('checked', false).trigger('change');\t\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n//\t}\n\t\n\t/*=====  End of TEMPORARY HACK   ======*/\n\t\n\n\n};\n\n$(document).on('click' , '.list-preventor' , function(e){\n\te.preventDefault()\n\treturn false;\n})\n\n$(document).on('change' , '.list-affector-element' , function(e){\n\n\nvar affects = $(this).attr('data-affects').split(',')\n\nif( $(this).is(':checked') ){\n\n\tfor( var i = 0 ; i < affects.length; i++ ){\n\t\t$('#preventor-'+affects[i]).hide()\n\t}\n\n\t//$('#'+target).prop('checked' , true).trigger('change')\n\n}else{\n\t\n\tfor( var i = 0 ; i < affects.length; i++ ){\n\t\t$('#preventor-'+affects[i]).show()\n\t\t$('#'+affects[i]).prop('checked' , false).trigger('change')\n\t}\n\n}\n\n\n})\n\n$(document).on('change' , '.parent-switch' , function(e){\n\nif( typeof e.originalEvent == \"undefined\" ){\n\nreturn false;\n\n}\nvar target = $(this).attr('data-for')\nvar affects = $(this).attr('data-prevents').split(',')\n\nif( $(this).is(':checked') ){\n\n\tfor( var i = 0 ; i < affects.length; i++ ){\n\t\t$('#preventor-'+affects[i]).hide()\n\t}\n\n\t$('#'+target).prop('checked' , true).trigger('change')\n\n}else{\n\t\n\tfor( var i = 0 ; i < affects.length; i++ ){\n\t\t$('#preventor-'+affects[i]).show()\n\t\t$('#'+affects[i]).prop('checked' , false).trigger('change')\t\t\n\t}\n\n\t$('#'+target).prop('checked' , false).trigger('change')\n\n}\n\n});\n\n\n$(document).on('change' , '#cbox-Kitchen_Optional_SunRoom' , function(){\n\n\tif( $(this).is(':checked') ){\n\t\t$('.preventor-cathe').css({\n\t\tdisplay : 'none'\n\t\t\t});\n\n\t}else{\n\n\n\t\t//turn all options off\n\n\t\t$('#cbox-Kitchen_Optional_Cathedral_ceiling').prop(\"checked\" , false).trigger('change');\n\n\t\t$('.preventor-cathe').css({\n\t\tdisplay : 'block'\n\t\t\t});\n\n\n}\n\n});\n\n$(document).on('change' , '#cbox-Optional_Dining_Room' , function(){\n\n\tif( $(this).is(':checked') ){\n\t\t\n\t\tif( $('input[data-combo=\"layer_04a069ff_5621_6cc4_7c4d_6412927a918b.png\"]').prop('checked') ) {\n\n\t\t $('input[data-combo=\"layer_04a069ff_5621_6cc4_7c4d_6412927a918b.png\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_88c44e9a_cfff_f4d9_3603_1e557e4efce6.png\"]').prop('checked') ) {\n\n\t\t $('input[data-combo=\"layer_88c44e9a_cfff_f4d9_3603_1e557e4efce6.png\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_5b9167db_af63_fa7c_7cf8_b922158cc441.png\"]').prop('checked') ) {\n\n\t\t $('input[data-combo=\"layer_5b9167db_af63_fa7c_7cf8_b922158cc441.png\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_4f783f55_c3cf_63dc_1910_16fe1cc8970d.png\"]').prop('checked') ) {\n\n\t\t $('input[data-combo=\"layer_4f783f55_c3cf_63dc_1910_16fe1cc8970d.png\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\n\t\tif( $('input[data-combo=\"layer_94796c68_2779_bc64_46b8_54bcdf33b086.png\"]').prop('checked') ) {\n\n\t\t $('input[data-combo=\"layer_94796c68_2779_bc64_46b8_54bcdf33b086.png\"]').prop('checked', false).trigger('change');\n\n\t\t}\n\n\t}else{\n\n\n\t\t//turn all options off\n\n\t\t$('#active-dining').prop(\"checked\" , false).trigger('change');\n\n\t\t$('.preventor').css({\n\t\tdisplay : 'block'\n\t\t\t});\n\n\t\t\n\t\tif( $('input[data-combo=\"layer_bb5c34e7_b3e0_be12_bd52_8bd1fb86e5b9.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_bb5c34e7_b3e0_be12_bd52_8bd1fb86e5b9.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_f61000c5_c65b_73ba_8087_41af4c81de24.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_f61000c5_c65b_73ba_8087_41af4c81de24.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_5411815b_5e3f_24a8_b5ef_a98658a99f96.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_5411815b_5e3f_24a8_b5ef_a98658a99f96.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_34b74a60_7a05_49e1_e8b9_d466f901f033.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_34b74a60_7a05_49e1_e8b9_d466f901f033.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_9b7a5f78_3d66_a474_2bb2_0839ef01aab3.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_9b7a5f78_3d66_a474_2bb2_0839ef01aab3.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\t\t\n\t\tif( $('input[data-combo=\"layer_5bf8c3db_71c4_210c_4ce4_94e44ba66306.png\"]').prop('checked') ) { \n\n\t\t\t$('input[data-combo=\"layer_5bf8c3db_71c4_210c_4ce4_94e44ba66306.png\"]').prop('checked', false).trigger('change');\n\n\t\t\t\t}\n\n\t}\n\n});\n\n\n$(document).on('change' , '.floor-element-switcher' , function(e){\n\n\t\n\t\n\tvar stage = $(this).data('stageid');\n\tvar moduleID = $(this).data('combo'); \n\tvar coords = $(this).data('coords');\n\tvar image = $(this).data('url');\n\tvar price = $(this).data('price');\n\t// var name = $(this).data('name');\n\tvar name = $(this).parent().text();\n\t\n\tvar floor = $(this).data('floor');\n\n\tvar ele = $(this);\n\tvar category_label = ele.parent().data('category');\n\t\n\tif( typeof e.originalEvent != \"undefined\"){\n\t\tmodulePairingSystem( ele );\t\n\t}\n\n\n\tif( typeof floorModules[moduleID] == \"undefined\" ){\n\n\t\t//show loader\n\n\t$('.main').block({ css: { \n            border: 'none', \n            padding: '15px', \n            backgroundColor: '#000', \n            '-webkit-border-radius': '10px', \n            '-moz-border-radius': '10px', \n            opacity: .5, \n            color: '#fff'\n        }, \n         overlayCSS:  { \n        backgroundColor: '#fff', \n        opacity:         0.6, \n        cursor:          'wait' \n    }, \n \n        message : 'Processing'\n         });\n\n\t\t//draw new \n\t\tsafeLoad(image , \"test\").then(function(response){\n\t\tvar img =  response.queue.getResult(response.id);\n\t\tvar new_rect = _self.rectDrawer({\n\t\tid \t\t\t: uuid(),\n\t\tstageid \t: stage,\n\t\tmoduleID    : moduleID, \n\t\tlabel \t\t: \"Doesnt matter\",\n\t\tdrawX \t\t: coords.x,\n\t\tdrawY \t\t: coords.y,\n\t\tdataSF\t\t: '',\n\t\tw     \t\t: img.width,\n\t\th     \t\t: img.height,\n\t\timage \t\t: img,\n\t\tstrokeColor : \"rgba(0, 255 , 0,0.5)\",\n\t\tfillColor   : \"rgba(0,0 , 255 ,0.5)\",\n\t\tstrokeStyle : 2,\n\t\t});\n\t\tfloorModules[moduleID] = new_rect;\n\n\t\tif( moduleID == \"layer_4ce007c6_36d5_3381_77dd_16a45424c3ba.png\" ){\n\t\t\tfloorModulesRects[moduleID].alpha = 0;\n\t\t\tstages[stage].update();\n\t\t}\n\n\t\t$('.main').unblock();\n\t\t//add module \n\t\t\tif( typeof  GLOBAL_FINAL.modules[floor] == \"undefined\"){\n\t\t\t\tGLOBAL_FINAL.modules[floor] = {};\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\tGLOBAL_FINAL.modules[floor][moduleID] = {\n\t\t\t\t\t\t\t        name : name,\n\t\t\t\t\t\t\t        price : price,\n\t\t\t\t\t\t\t        imgUrl : image,\n\t\t\t\t\t\t\t        category : category_label\n\t\t\t\t\t\t\t      };\n\t\t\t\t});\n\n\t\tsetTimeout(function(){\n\t\t\tGLOBAL_FINAL.modules[floor]['extraInfo']['image'] = $('#'+stage)[0].toDataURL();\n\t\t},500);\n\n\n\t\t//start filling\n\t\t\t\tvar UpdatedPrice = $('#UpdatedPrice').text();\n\t\t\t\tUpdatedPrice =  parseFloat(UpdatedPrice.replace(',' , ''))  + parseFloat(price);\n\t\t\t\tvar total = UpdatedPrice;\n\t\t\t\t$('#UpdatedPrice').text( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t//dialog box\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\t\t\t\tvar base = ( isNaN(parseFloat( $('#UpdatedPrice').data('base-price') ) ) ) ? 0 : parseFloat( $('#UpdatedPrice').data('base-price') );\n\t\t\t\t$('#popup-options-selected').html( _self._formatter.to( total - base ) );\n\t\t\t\t//update slider\n\t\t\t\tvar pslider = document.getElementById('pslider');\n\n\t\t\t\tpslider.noUiSlider.updateOptions({\n\t\t\t\trange: {\n\t\t\t\t'min': 0,\n\t\t\t\t'max': total\n\t\t\t\t}\n\t\t\t});\n\n\t\t// end filling\n\t\t\n\t}else{\n\n\t\tif( $(this).is(':checked') ){\n\n\t\t\t//start filling\n\t\t\t\tvar UpdatedPrice = $('#UpdatedPrice').text();\n\t\t\t\tUpdatedPrice =  parseFloat(UpdatedPrice.replace(',' , ''))  + parseFloat(price);\n\t\t\t\tvar total = UpdatedPrice;\n\t\t\t\t$('#UpdatedPrice').text( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t//dialog box\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\t\t\t\tvar base = ( isNaN(parseFloat( $('#UpdatedPrice').data('base-price') ) ) ) ? 0 : parseFloat( $('#UpdatedPrice').data('base-price') );\n\t\t\t\t$('#popup-options-selected').html( _self._formatter.to( total - base ) );\n\t\t\t\t//update slider\n\t\t\t\tvar pslider = document.getElementById('pslider');\n\n\t\t\t\tpslider.noUiSlider.updateOptions({\n\t\t\t\trange: {\n\t\t\t\t'min': 0,\n\t\t\t\t'max': total\n\t\t\t\t}\n\t\t\t});\n\n\t\t// end filling\n\n\t\t\tfloorModules[moduleID].alpha=1;\n\t\t\tif( moduleID != \"layer_4ce007c6_36d5_3381_77dd_16a45424c3ba.png\" ){\n\t\t\n\t\t\tfloorModulesRects[moduleID].alpha = 1;\n\n\t\t}\n\t\t\tstages[stage].update();\n\t\t\t\n\t\t\tsetTimeout(function(){\n\t\t\tGLOBAL_FINAL.modules[floor]['extraInfo']['image'] = $('#'+stage)[0].toDataURL();\n\t\t\t},500);\n\n\t\t\t//add module \n\t\t\tif( typeof  GLOBAL_FINAL.modules[floor] == \"undefined\"){\n\t\t\t\tGLOBAL_FINAL.modules[floor] = {};\n\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\tGLOBAL_FINAL.modules[floor][moduleID] = {\n\t\t\t\t\t\t\t        name : name,\n\t\t\t\t\t\t\t        price : price,\n\t\t\t\t\t\t\t        imgUrl : image,\n\t\t\t\t\t\t\t        category : category_label\n\t\t\t\t\t\t\t      };\n\n\t\t\t//$('.main').unblock();\n\t\t}else{\n\n\t\t\t//start filling\n\t\t\t\tvar UpdatedPrice = $('#UpdatedPrice').text();\n\t\t\t\tUpdatedPrice =  parseFloat(UpdatedPrice.replace(',' , ''))  + parseFloat(price);\n\t\t\t\tvar total = UpdatedPrice;\n\t\t\t\t$('#UpdatedPrice').text( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\n\t\t\t\t//dialog box\n\t\t\t\t$('#total-price-counter').html( _self._formatter.to(UpdatedPrice) );\n\t\t\t\tvar base = ( isNaN(parseFloat( $('#UpdatedPrice').data('base-price') ) ) ) ? 0 : parseFloat( $('#UpdatedPrice').data('base-price') );\n\t\t\t\t$('#popup-options-selected').html( _self._formatter.to( total - base ) );\n\t\t\t\t//update slider\n\t\t\t\tvar pslider = document.getElementById('pslider');\n\n\t\t\t\tpslider.noUiSlider.updateOptions({\n\t\t\t\trange: {\n\t\t\t\t'min': 0,\n\t\t\t\t'max': total\n\t\t\t\t}\n\t\t\t});\n\n\t\t// end filling\n\t\t\t\n\t\t\tfloorModules[moduleID].alpha=0;\n\t\t\tfloorModulesRects[moduleID].alpha = 0;\n\t\t\tstages[stage].update();\n\n\t\t\t//remove \n\n\t\t\tdelete GLOBAL_FINAL.modules[floor][moduleID];\n\t\t\t\n\t\t\tsetTimeout(function(){\n\t\t\tGLOBAL_FINAL.modules[floor]['extraInfo']['image'] = $('#'+stage)[0].toDataURL();\n\t\t\t},500);\n\n\t\t\t// $('.main').unblock();\n\t\t}\n\n\t}\n\t\n});\n\nvar increment = 0.1;\n$(document).on('click' , '.plan-zoom-reset' , function(){\nvar target = $('#stage-'+ $(this).data('target') );\n\ntarget.panzoom( 'zoom' , 1.1 , {animate : true});\ntarget.panzoom( 'pan' , 0, 0 , {animate : true} );\n$('.zoom-text-'+ $(this).data('target')).text( '10%' );\n$('.plan-zoomout , .plan-zoomin').data('val', 1.1);\n});\n\n$(document).on('click' , '.plan-zoomin' , function(){\nvar target = $('#stage-'+ $(this).data('target') );\nvar z = $(this).data('val');\nz = parseFloat(z);\nz =  (z > 1.9) ? 2 : z+increment;\n$('.plan-zoomout , .plan-zoomin').data('val', z);\n$('.zoom-text-'+ $(this).data('target')).text( parseInt ( ( (z-1)/1)*100 )+'%' );\ntarget.panzoom(\"zoom\", z, { animate : true });\n});\n\n$(document).on('click' , '.plan-zoomout' , function(){\nvar target = $('#stage-'+ $(this).data('target') );\nvar z = $(this).data('val');\nz = parseFloat(z);\nz =  (z < 1.1) ? 1 : z - increment;\n$('.plan-zoomout , .plan-zoomin').data('val', z);\n$('.zoom-text-'+ $(this).data('target')).text( parseInt ( ( (z-1)/1)*100 )+'%' );\ntarget.panzoom(\"zoom\", z, { animate : true });\n});\n\n\n$(document).on('submit' , '#notes-form' , function(e){\ne.preventDefault();\n\nwindow.localStorage.setItem(\"floor-note\" , $('#note-textarea').val() );\n\nswal('Saved' , \"Note has been saved\" , \"success\");\n});\n\n\n\n\n\nfunction fixRightView(){\n\t$('#interactive-wrapper canvas').css({\n\t\theight : $(window).outerHeight() - 252 + 50\n\t});\n}\n$(window).on('resize' , function(){\n\tfixRightView();\n});\nfixRightView();\nreturn _self;\n};\n\n\n\n$(document).on('click' , '#next-btn' , function(e){\n\te.preventDefault();\n\t\n\t\n\t swal({\n      title: \"Are you sure you want to go back ?\",\n      text: \"This action will clear this session and restart a new one. \",\n      type: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#7FBF34',\n      cancelButtonColor: '#1D5F70',\n      confirmButtonText: \"Yes\"\n    }).then((result) => {\n      if (result.value) {\n        \n        \n        window.location.href = \"http://forbes.xhome360.com\";\n      \n\n        \n      }else{\n        //cancelled \n\n      }\n    });\n\t\n\t\n});"]],"start1":0,"start2":0,"length1":0,"length2":37598}],"length":37598}
{"ts":1520449169,"restoring":false,"user_id":4416,"patch":[{"diffs":[[0,"ects[i]).show()\n"],[1,"\t\t\n\t\tif( $('#'+affects[i]).prop('checked') ){\n\t\t\n"],[0,"\t\t$('#'+affects["]],"start1":25996,"start2":25996,"length1":32,"length2":81},{"diffs":[[0,"hange')\n"],[1,"\t\t\n\t\t  }\n"],[0,"\t}\n\n}\n\n\n"]],"start1":26115,"start2":26115,"length1":16,"length2":25}],"length":37656}
{"ts":1520449899,"restoring":false,"user_id":4416,"patch":[{"diffs":[[0,"ange');\n"],[1,"\t\t\t//check for the switches too\n\t\t\tvar __id = $('input[data-combo=\"'+c+'\"]').attr('id');\n\t\t\t\n\t\t\t\n"],[0,"\t\t\t\t}\n\n\t"]],"start1":23560,"start2":23560,"length1":16,"length2":113}],"length":37753}
{"ts":1520449900,"restoring":false,"user_id":4416,"patch":[{"diffs":[[0,"');\n\t\t\t\n\t\t\t\n"],[1,"\t\t\t\n"],[0,"\t\t\t\t}\n\n\t\t}\n\t"]],"start1":23653,"start2":23653,"length1":24,"length2":28}],"length":37757}
{"ts":1520450019,"restoring":false,"user_id":4416,"patch":[{"diffs":[[0,"ined\"){\n"],[1,"\t\t\t\tif( $('input[data-combo=\"'+c+'\"]').prop('checked') ){\n"],[0,"\t\t\t$('in"]],"start1":23484,"start2":23484,"length1":16,"length2":74},{"diffs":[[0,"ange');\n"],[1,"\t\t\t\t}\n\t\t\t\n"],[0,"\t\t\t//che"]],"start1":23618,"start2":23618,"length1":16,"length2":26},{"diffs":[[0,"('id');\n\t\t\t\n"],[1,"\t\t\tif( $('#'+__id+'-parent').prop('checked') ){\n\t\t\t\t$('#'+__id+'-parent').prop('checked' , false).trigger('change');\n\t\t\t}\n\t\t\t\n"],[0,"\t\t\t\n\t\t\t\n\t\t\t\t"]],"start1":23717,"start2":23717,"length1":24,"length2":150}],"length":37951}
{"ts":1520450392,"restoring":false,"user_id":4416,"patch":[{"diffs":[[0,"rigger('change')"],[1,"\n\t\n\t//check for conflict \n\t\n\tmodulePairingSystem( $('#'+target) )\n\t"],[0,"\n\n}else{\n\t\n\tfor("]],"start1":26811,"start2":26811,"length1":32,"length2":99}],"length":38018}