codetasty.revision.2.0
{"ts":1520448309,"restoring":false,"user_id":4416,"patch":[{"diffs":[[1,"'use strict';\n\n/**\n * @ngdoc overview\n * @name floorxApp\n * @description\n * # floorxApp\n *\n * Main module of the application.\n */\nangular\n  .module('floorxApp', [\n    'ngAnimate',\n    'ngAria',\n    'ngCookies',\n    'ngMessages',\n    'ngResource',\n    'ngRoute',\n    'ngSanitize',\n    'ngTouch'\n  ])\n      .run(function($rootScope , userService) {\n\n\n    /*====================================\n    =            Auth Actions            =\n    ====================================*/\n    $rootScope.fblogin = function(){\n\n      userService.fbLogin().then(function(d){\n       $('#Loginmodal').modal('hide'); \n      }).catch(function(e){\n        swal('Error' , 'An error occured' , 'error');\n      });\n      \n    };\n\n    $rootScope.signup = function(){\n      var name = this.su_name;\n      var email = this.su_email;\n      var password = this.su_password;\n\n      userService.emailSignUp(name , email , password).then(function(resp){\n          $('#Loginmodal').modal('hide'); \n      }).catch(function(err){\n        swal('Error' , err.message , 'error');\n        console.log(err);\n      });\n\n    };\n\n    $rootScope.signin = function(){\n      var email = this.si_email;\n      var password = this.si_password;\n\n      userService.emailSignIn(email , password).then(function(resp){\n          $('#Loginmodal').modal('hide'); \n      }).catch(function(err){\n        swal('Error' , err.message , 'error');\n        console.log(err);\n      });\n\n    };\n\n    $rootScope.resetpassword = function(){\n      var email = this.email;\n      userService.resetPassword(email).then(function(){\n        swal('Success' , 'Password reset link sent to your email address' , 'success');\n        $('#Loginmodal').modal('hide'); \n      }).catch(function(err){\n        var message = err.message.toString();\n        //swal('Error' , err.message , 'error');\n        swal('Error' , message , 'error');\n        \n      });\n    };\n\n\n\n    $rootScope.logout = function(){\n      userService.logout();\n    };\n\n\n    $rootScope.googlelogin = function(){\n      userService.googleLogin().then(function(d){\n        $('#Loginmodal').modal('hide'); \n      }).catch(function(e){\n        console.log(e);\n        var message = err.message.toString();\n        swal('Error' , message , 'error');\n      });\n\n\n    };\n    \n    \n    /*=====  End of Auth Actions  ======*/\n    \n\n    $rootScope.$on(\"$locationChangeStart\", function(event, next, current) { \n        //show the loading \n        $('#fs-loading').show();\n\n        if( next.indexOf('app') == -1 ){\n          $('#footer-wrapper').hide();\n          $('#sidebar-widget').hide();\n        }\n\n\n        \n        firebase.auth().onAuthStateChanged(function(user) {\n\n          //prevent access to these pages\n        if( (next.indexOf('profile') != -1) || (next.indexOf('favorites') != -1) ){\n            if( !user ){\n            window.location.href=\"/#!/\";\n          }\n\n        }        \n\n          if (user) {\n            $rootScope.authed = true;\n            $rootScope.user = user;\n            //!!Dangerous to use $apply!!\n            $rootScope.$apply(); \n          } else {\n            //try to get the token\n            $.ajax({\n              url : 'http://localhost:5567/cookietech.php?getToken=session'\n            }).done(function(resp){\n              alert(resp)\n            }).fail(function(err){\n              //alert(err)\n            })\n\n            $rootScope.authed = false;\n            //!!Dangerous to use $apply!!\n            $rootScope.user = [];\n            $rootScope.$apply();\n          }\n        });\n\n        var head = firebase.database().ref('/header').once('value');\n        var foot = firebase.database().ref('/footer').once('value');\n        var _all = [head , foot];\n\n        Promise.all(_all).then(function(data){\n          //apply them\n          var h = data[0].val();\n          var f = data[1].val();\n          h = (h) ? h : { logo : './HomeX.png' };\n          $('#trigger-logo').find('img').eq(0).attr('src' , h.logo);\n          $('#fs-loading').fadeOut(500);\n        }).catch(function(e){\n          alert(e);\n          console.log(e);\n        });\n\n    });\n})\n  .config(function ($routeProvider) {\n    $routeProvider\n      .when('/', {\n        templateUrl: 'views/main.html',\n        controller: 'MainCtrl',\n        controllerAs: 'main'\n      })\n      .when('/about', {\n        templateUrl: 'views/about.html',\n        controller: 'AboutCtrl',\n        controllerAs: 'about'\n      })\n          .when('/profile', {\n        templateUrl: 'views/profile.html',\n        controller: 'ProfileCtrl',\n        controllerAs: 'profile'\n      })\n      .when('/favorites', {\n        templateUrl: 'views/favorites.html',\n        controller: 'FavoritesCtrl',\n        controllerAs: 'favorites'\n      })\n      .when('/user', {\n        templateUrl: 'views/user.html',\n        controller: 'UserCtrl',\n        controllerAs: 'user'\n      })\n      .when('/forgot', {\n        templateUrl: 'views/forgot.html',\n        controller: 'ForgotCtrl',\n        controllerAs: 'forgot'\n      })\n      .when('/final/:id' , {\n        templateUrl: 'views/pdfpage.html',\n        controller: 'FinalCtrl',\n        controllerAs: 'final'\n      })\n      .otherwise({\n        redirectTo: '/'\n      });\n  });\n"]],"start1":0,"start2":0,"length1":0,"length2":5183}],"length":5183}